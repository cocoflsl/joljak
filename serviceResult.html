<!-- serviceDrawBoard.html-->
<!DOCTYPE html>
<html>
	<head>
        <title>검색 결과</title>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="style.css">

		<style>
			#tab2 {
				font-weight: bold;
			}

			body {
                background: #e2e1e0;
                text-align: center;
            }

            .container {
                background: #fff;
                margin: 30px auto;
                border-radius: 2px;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
                width: 60%;
                min-height: 90vh;
                display : flex;
                flex-direction: column;
                align-content: center;
            }

            .search-header {
                display: block;
                font-family: "lobster";
                font-size: 80px;
                margin-top : 150px;
            }
            .search-content{
                margin : 50px auto;
                border : none;
                border : 2px solid #a0a0a0;
                border-radius : 25px;
                width : 350px;
                padding : 5px 5px;
            }
            #search-input {
                margin : 0 auto;
                width : 300px;
                padding : 5px;
                border : none;
            }
            #search-input:focus{
                outline : none;
                background-color: #fff;
            }
            #search-btn{
                display : inline-block;
                background: none;
                padding : 5px;
                border : none;
            }
            #search-btn:focus{
                outline : none;
            }
            #btn-icon{
                font-family : Material Icons;
                font-weight : bold;
                cursor : pointer;
            }

			.gallery {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
				gap: 10px;
				padding: 20px;
			}

			.gallery img {
				width: 100%;
				height: auto;
				display: block;
			}

			p {
				text-align: left;
			}
		</style>

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet">
	</head>
    <body>
        <header>
			<span><a href="index.html" class="Merriweather">To CloThes</a></span>
			<span><a href="serviceIntro.html" class="nav-link" id="tab1">서비스 소개</a></span>
			<span><a href="serviceUse.html" class="nav-link" id="tab2">서비스 이용</a></span>
			<span><a href="previous.html" class="nav-link" id="tab3">이전 기록 열람</a></span>
			<span><a href="login.html" class="Merriweather-small">Login</a></span>
		</header>

		<div class="container">
			<h1>검색 결과<h1>
			<div class="search-content">
    			<form id="imageSearchForm">
					<input type="file" id="imageInput" accept="image/*">
					<button type="submit" id="search-btn">
						<span id="btn-icon" class="material-icons">search</span>
					</button>
				</form>
			</div>
			<div id="imageResults"></div>
		</div>

        <script>
			// Bing Visual Search API 키
			const API_KEY = '84900ec94e08423b9468f053da33eff9';

			// 이미지 검색 함수
			async function searchImages(query) {
				const url = `https://api.bing.microsoft.com/v7.0/images/visualsearch?q=${encodeURIComponent(query)}`;

				try {
					const response = await fetch(url, {
						headers: {
							'Ocp-Apim-Subscription-Key': API_KEY
						}
					});

					if (!response.ok) {
						throw new Error('Bing Visual Search API 호출에 실패했습니다.');
					}

					const data = await response.json();
					return data;
				} catch (error) {
					console.error('API 호출 오류:', error.message);
					return null;
				}
			}

			// 이미지 검색 폼
			const imageSearchForm = document.getElementById('imageSearchForm');
			const imageInput = document.getElementById('imageInput');
			const imageResults = document.getElementById('imageResults');

			imageSearchForm.addEventListener('submit', async function(event) {
				event.preventDefault();
				const file = imageInput.files[0];
				if (!file) {
					console.error('이미지를 선택하세요.');
					return;
				}

				try {
					const base64 = await convertImageToBase64(file);
					const result = await searchImages(base64);
					displayImages(result);
				} catch (error) {
					console.error('이미지 검색 오류:', error);
				}
			});

			// 이미지를 Base64로 변환
			function convertImageToBase64(file) {
				return new Promise((resolve, reject) => {
					const reader = new FileReader();
					reader.onload = () => resolve(reader.result.split(',')[1]);
					reader.onerror = error => reject(error);
					reader.readAsDataURL(file);
				});
			}

			// 검색 결과를 화면에 표시
			function displayImages(result) {
				imageResults.innerHTML = ''; // 이전 결과 지우기
				if (result && result.tags && result.tags.length > 0) {
					result.tags.forEach(tag => {
						if (tag.actions && tag.actions.length > 0) {
							const imageUrl = tag.actions[0].data.value;
							const img = document.createElement('img');
							img.src = imageUrl;
							imageResults.appendChild(img);
						}
					});
				} else {
					console.error('검색 결과가 없습니다.');
				}
			}
        </script>
    </body>
</html>
